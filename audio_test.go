
package main

import (
	"testing"
	"bytes"
	"encoding/hex"
)

func TestAudioDemux(t *testing.T) {
	data := []byte{
		0x0,0x10,0x4,0x0,0xff,0xf1,0x60,0x80,0x10,0x2,0xbc,0x21,0x19,0x54,0xe1,0x29,0x18,0x44,0x15,0x0,0x5e,0xa5,0x54,0x51,0x57,0x4a,0x92,0x92,0x54,0x42,0x4b,0xbb,0xbb,0xe2,0x4,0x80,0xb7,0x81,0x21,0x9,0x53,0xa8,0xcb,0x63,0xf9,0x63,0x19,0x3,0xe2,0xdf,0x6f,0xc,0xf3,0xf1,0xe0,0xb2,0xd9,0xc,0xd,0xd0,0xdc,0x4b,0xd3,0x3,0xe3,0x47,0x7e,0xf5,0xcd,0x43,0x3a,0x32,0x56,0xd,0xff,0x87,0x3,0x48,0x11,0x5e,0xad,0x84,0x7c,0x80,0x57,0x37,0x88,0xc5,0xe2,0xc6,0x30,0xbf,0x68,0xa8,0x64,0x31,0xcf,0x2b,0xdc,0xb9,0x11,0x79,0xf6,0xa4,0xc7,0x18,0x6,0x99,0x2,0x73,0xb,0x2,0x10,0x94,0xd2,0x4,0xa6,0xaa,0x73,0x8,0x5a,0x41,0x32,0x29,0x84,0x11,0xb0,0xf,0x98,0x61,0x10,0xe0,
	}
	// libavformat/rtpdec_mpeg4.c
	// a=rtpmap:97 MPEG4-GENERIC/16000/2
	// a=fmtp:97 streamtype=5;profile-level-id=1;mode=AAC-hbr;sizelength=13;indexlength=3;indexdeltalength=3;config=1408
	config := Mpeg4AudioConfig{
		SizeLength: 13,
		IndexLength: 3,
	}

	payload := ParseAUFrame(data, config)
	t.Logf("payload=%x", payload)

	var err error
	data, _ = hex.DecodeString("1408")
	br := bytes.NewReader(data)
	if err = ParseAudioSpecificConfig(br, &config); err != nil {
		t.Error(err)
		return
	}

	t.Logf("Mpeg4AudioConfig=%v", config)

	bw := &bytes.Buffer{}
	WriteBitsADTSFrameHeader(bw, config, 15)
	t.Logf("ADTSHeader=%x", bw.Bytes())
}

